(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7821:function(e,s,t){Promise.resolve().then(t.bind(t,6590))},6590:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return T}});var l=t(7437),r=t(2265),a=t(1923),c=t(344),n=t(619);let o=async e=>{if(!n.C5)throw Error("This function can only be called in client-side code");return(0,n.DA)()||await (0,c.qN)(),e()},i=async e=>o(async()=>{try{console.log("初期データ取得中... filePath: ".concat(e||"なし"));let[s,t]=await Promise.allSettled([a.apiClient.get("/metrics",{file_path:e}),a.apiClient.get("/projects",{file_path:e})]),l={};return"fulfilled"===s.status&&(l.metrics=s.value),"fulfilled"===t.status&&(l.projects=t.value),"rejected"===s.status&&"rejected"===t.status&&(l.error=s.reason),l}catch(e){return console.error("初期データ取得失敗:",e),{error:e}}}),d=async(e,s)=>o(async()=>{try{console.log("最近のタスク取得中... projectId: ".concat(e,", filePath: ").concat(s||"なし"));let t=await a.apiClient.get("/projects/".concat(e,"/recent-tasks"),{file_path:s});return console.log("最近のタスク取得成功"),t}catch(e){throw console.error("最近のタスク取得失敗:",e),e}}),x=async()=>o(async()=>{try{console.log("デフォルトファイルパス取得中...");let e=await a.apiClient.get("/files/default-path");return console.log("デフォルトファイルパス取得成功: ".concat(e.path||"パスなし")),e}catch(e){return console.error("デフォルトファイルパス取得失敗:",e),{success:!1,message:e.isApiError?"デフォルトパス取得エラー: ".concat(e.details):"デフォルトパス取得中に予期しないエラーが発生しました: ".concat(e.message),path:null}}}),m=async e=>o(async()=>{try{console.log("ファイルを開く... path: ".concat(e));let s=await a.apiClient.post("/files/open",{path:e});return console.log("ファイルを開く成功: ".concat(s.success?"成功":"失敗")),s}catch(e){return console.error("ファイルを開く失敗:",e),{success:!1,message:e.isApiError?"ファイルを開くエラー: ".concat(e.details):"ファイルを開く際に予期しないエラーが発生しました: ".concat(e.message),path:null}}}),h=null,u=0,p=async e=>{if(console.log("selectFile: 関数が呼び出されました",{initialPath:e}),!n.C5)return console.log("selectFile: クライアントサイドではありません"),{success:!1,message:"クライアント側でのみ使用可能な機能です",path:null};let s=Date.now();if(h&&s-u<6e4)return console.log("selectFile: キャッシュされた選択結果を再利用",h),h;try{var t,l,r;console.log("selectFile: 環境を検証します");let c={isClient:n.C5,isElectron:(0,n.yv)(),hasElectronObj:void 0!==window.electron,hasDialogObj:void 0!==(null===(t=window.electron)||void 0===t?void 0:t.dialog),hasOpenCSVMethod:"function"==typeof(null===(r=window.electron)||void 0===r?void 0:null===(l=r.dialog)||void 0===l?void 0:l.openCSVFile),nodeEnv:"production"};if(console.log("selectFile: 環境変数:",c),!c.isElectron||!c.hasOpenCSVMethod)return console.log("selectFile: APIベースのファイル選択を使用します"),await o(async()=>{console.log("selectFile: APIリクエスト開始: /files/select");let t=await a.apiClient.get("/files/select",{initial_path:e});return console.log("selectFile: API選択結果:",t),h=t,u=s,t});console.log("selectFile: Electron対応ファイル選択を使用します");try{console.log("selectFile: window.electron.dialog.openCSVFile を呼び出します");let t=await window.electron.dialog.openCSVFile(e||"");return console.log("selectFile: Electron選択結果:",t),h=t,u=s,t}catch(e){throw console.error("selectFile: Electronダイアログエラー:",e),e}}catch(e){return console.error("selectFile: エラー発生:",e),{success:!1,message:e.isApiError?"ファイル選択エラー: ".concat(e.details):"ファイル選択中に予期しないエラーが発生しました: ".concat(e.message),path:null}}},g=async()=>o(async()=>{try{console.log("APIヘルスチェック実行中...");let e=await a.apiClient.get("/health");return console.log("APIヘルスチェック成功:",e),e}catch(e){throw console.error("APIヘルスチェック失敗:",e),e}}),j=async()=>{if(!n.C5)return{success:!1,message:"クライアント側でのみ実行可能な機能です"};try{console.log("API接続テスト実行中...");let e=await g();return{success:!0,message:"APIサーバーに接続しました: ".concat(e.status||"OK"),details:e}}catch(e){return console.error("API接続テスト失敗:",e),{success:!1,message:e.isApiError?"接続エラー: ".concat(e.details):"API接続テスト中に予期しないエラーが発生しました: ".concat(e.message),details:e}}};var f=t(4108),v=t(3282);let y=e=>{var s,t,l;if(!n.C5||!(0,n.yv)()){console.log("Electronディスパッチャの初期化をスキップ: 対象環境ではありません");return}console.log("Electronディスパッチャの初期化: リスナーを登録");let r=null===(s=window.electron)||void 0===s?void 0:s.ipcRenderer.on("api-connection-established",e.onConnectionEstablished),a=null===(t=window.electron)||void 0===t?void 0:t.ipcRenderer.on("api-server-down",e.onServerDown),c=null===(l=window.electron)||void 0===l?void 0:l.ipcRenderer.on("api-server-restarted",e.onServerRestarted);return()=>{console.log("Electronディスパッチャのクリーンアップ: リスナーを解除"),r&&r(),a&&a(),c&&c()}},w=(e,s)=>{if(n.C5)try{localStorage.setItem("dashboard_".concat(e,"_timestamp"),Date.now().toString()),localStorage.setItem("dashboard_".concat(e),JSON.stringify(s))}catch(s){console.warn("データ保存エラー (".concat(e,"):"),s)}},N=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36e5;if(!n.C5)return null;try{let t=localStorage.getItem("dashboard_".concat(e,"_timestamp"));if(!t)return null;let l=Date.now()-parseInt(t);if(l>s)return null;let r=localStorage.getItem("dashboard_".concat(e));return r?JSON.parse(r):null}catch(s){return console.warn("データ読み込みエラー (".concat(e,"):"),s),null}},b=e=>{let[s,t]=(0,r.useState)(null),[l,a]=(0,r.useState)(null),[c,o]=(0,r.useState)(!1),[d,x]=(0,r.useState)(null),{addNotification:h}=(0,f.l)(),[u,p]=(0,r.useState)(!1),{status:g,reconnectAttempts:j,checkConnection:b}=(0,v.h)();(0,r.useEffect)(()=>{if(!n.C5||!(0,n.yv)())return;let s=y({onConnectionEstablished:s=>{console.log("API接続確立:",s),h("APIサーバーへの接続が確立されました (ポート: ".concat(s.port,")"),"success"),e&&S()},onServerDown:e=>{console.error("APIサーバーダウン:",e),h(e.message||"バックエンドサーバーが応答していません","error"),x({message:"バックエンドサーバーが応答していません",details:{message:e.message,time:new Date().toISOString()}})},onServerRestarted:s=>{console.log("APIサーバー再起動:",s),h("バックエンドサーバーが再起動しました (ポート: ".concat(s.port,")"),"info"),e&&setTimeout(()=>S(),1e3)}});return()=>{s&&s()}},[h,e]),(0,r.useEffect)(()=>{if(!n.C5||u)return;let e=N("projects"),s=N("metrics");e&&(t(e),console.log("キャッシュからプロジェクトデータを復元")),s&&(a(s),console.log("キャッシュからメトリクスデータを復元")),p(!0)},[u]);let S=(0,r.useCallback)(async()=>{if(n.C5){if(!e){h("ファイルが選択されていません","error");return}if(!g.connected){let e=await b();if(!e)return}o(!0),x(null);try{let s=await i(e);if(s.projects&&(t(s.projects),w("projects",s.projects)),s.metrics&&(a(s.metrics),w("metrics",s.metrics)),s.error)throw s.error}catch(t){let e=t.message||"データの取得中にエラーが発生しました",s=t.details||t;console.error("データ取得エラー:",t),x({message:e,details:s}),h(e,"error")}finally{o(!1)}}},[e,h,g.connected,b]);(0,r.useEffect)(()=>{n.C5&&e&&g.connected&&S()},[e,S,g.connected]);let C=(0,r.useCallback)(async()=>{if(n.C5){if(!e){h("ファイルが選択されていません","error");return}try{await S(),d||h("データが更新されました","success")}catch(e){console.error("データ更新エラー:",e)}}},[e,S,h,d]),I=(0,r.useCallback)(async e=>{if(n.C5)try{let s=await m(e);s.success?h("ファイルを開きました","success"):h(s.message||"ファイルを開けませんでした","error")}catch(s){let e=s.message||"ファイルを開く際にエラーが発生しました";console.error("ファイルを開く際のエラー:",s),h(e,"error")}},[h]);return(0,r.useEffect)(()=>{if(!n.C5||!e||!g.connected)return;let s=null,t=!0,l=()=>{document.hidden?(s&&(clearInterval(s),s=null),t=!1):(t||(S(),r()),t=!0)},r=()=>{s&&clearInterval(s),s=setInterval(()=>{t&&S()},3e5)};return document.addEventListener("visibilitychange",l),r(),()=>{document.removeEventListener("visibilitychange",l),s&&clearInterval(s)}},[e,g.connected,S]),{projects:s,metrics:l,isLoading:c,apiStatus:g,reconnectAttempts:j,error:d,refreshData:C,fetchData:S,openFile:I,checkApiConnection:b}};var S=t(4033),C=e=>{let{onSelectFile:s,selectedFilePath:t}=e,{addNotification:a}=(0,f.l)(),[c,o]=(0,r.useState)(!1),[i,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{var e;let s=(0,n.yv)();d(s),console.log("FileSelector: Electron環境の検出結果:",s,{windowElectron:window.electron?"存在します":"存在しません",windowElectronDialog:(null===(e=window.electron)||void 0===e?void 0:e.dialog)?"存在します":"存在しません"})},[]);let x=async()=>{console.log("FileSelector: handleSelectFile が呼び出されました"),o(!0);try{console.log("FileSelector: selectFile を呼び出します...");let e=await p(t||void 0);console.log("FileSelector: selectFile の結果:",e),e.success&&e.path?(console.log("FileSelector: ファイル選択成功:",e.path),s(e.path),a("ファイルを選択しました: ".concat(e.path),"success")):(console.log("FileSelector: ファイル選択失敗または中断:",e.message),e.message&&a(e.message,"error"))}catch(e){console.error("FileSelector: ファイル選択エラー:",e),a("ファイルの選択中にエラーが発生しました","error")}finally{console.log("FileSelector: handleSelectFile 完了"),o(!1)}},m=async()=>{var e;if(console.log("FileSelector: testElectronDialog が呼び出されました"),(0,n.yv)()&&(null===(e=window.electron)||void 0===e?void 0:e.testDialog))try{console.log("FileSelector: Electron testDialog を実行...");let e=await window.electron.testDialog();console.log("FileSelector: testDialog 結果:",e),a("ダイアログテスト: "+(e.success?"成功":"失敗"),e.success?"success":"error")}catch(e){console.error("FileSelector: ダイアログテストエラー:",e),a("ダイアログテストエラー","error")}else console.log("FileSelector: Electron環境が検出されませんでした"),a("Electron環境が検出されませんでした","error")};return(0,l.jsxs)("div",{className:"flex items-center flex-wrap",children:[t&&(0,l.jsxs)("div",{className:"text-text-secondary text-xs mr-2 max-w-xs truncate mb-2",children:["現在のファイル: ",t]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)("button",{onClick:x,disabled:c,className:"bg-transparent text-text-accent px-2.5 py-1.5 rounded border border-text-accent text-xs hover:bg-text-accent hover:text-surface transition-colors disabled:opacity-50 disabled:cursor-not-allowed","data-testid":"file-select-button",children:[c?"選択中...":"参照"," ",i?"(E)":"(A)"]}),(0,l.jsx)("button",{onClick:m,className:"bg-transparent text-purple-400 px-2.5 py-1.5 rounded border border-purple-400 text-xs hover:bg-purple-400 hover:text-surface transition-colors",children:"診断"}),(0,l.jsx)("button",{onClick:()=>{console.log("FileSelector: handleManualInput が呼び出されました");let e=prompt("CSVファイルの完全パスを入力してください:",t||"");e&&(s(e),a("ファイルパスを手動で設定しました: ".concat(e),"success"))},className:"bg-transparent text-gray-400 px-2.5 py-1.5 rounded border border-gray-400 text-xs hover:bg-gray-400 hover:text-surface transition-colors",children:"パスを入力"})]})]})},I=e=>{let{updateTime:s,onRefresh:t,selectedFilePath:a,onSelectFile:c}=e;(0,S.usePathname)();let{addNotification:n}=(0,f.l)(),[o,i]=(0,r.useState)(!1);return(0,l.jsx)("header",{className:"bg-surface border-b border-opacity-10 border-white shadow-md",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-text-primary",children:"プロジェクト進捗ダッシュボード"}),(0,l.jsx)("p",{className:"text-text-secondary text-sm",children:s})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(C,{onSelectFile:e=>{console.log("Header: handleSelectFile が呼び出されました",{path:e}),c(e)},selectedFilePath:a}),(0,l.jsx)("button",{onClick:t,className:"bg-text-accent text-surface px-2.5 py-1.5 rounded text-xs hover:bg-opacity-80 transition-colors ml-2",children:"更新"})]})]})})},k=e=>{let{summary:s,isLoading:t}=e;return t?(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,l.jsxs)("div",{className:"bg-surface rounded-lg shadow-card p-4 animate-pulse h-24",children:[(0,l.jsx)("div",{className:"h-4 bg-gray-700 rounded w-1/2 mb-2"}),(0,l.jsx)("div",{className:"h-8 bg-gray-700 rounded w-1/4"})]},s))}):(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,l.jsxs)("div",{className:"dashboard-card",children:[(0,l.jsx)("h3",{className:"text-text-secondary text-sm font-medium",children:"総プロジェクト数"}),(0,l.jsx)("h2",{className:"text-text-primary text-2xl font-bold",children:s.total_projects})]}),(0,l.jsxs)("div",{className:"dashboard-card",children:[(0,l.jsx)("h3",{className:"text-text-secondary text-sm font-medium",children:"進行中"}),(0,l.jsx)("h2",{className:"text-status-info text-2xl font-bold",children:s.active_projects})]}),(0,l.jsxs)("div",{className:"dashboard-card",children:[(0,l.jsx)("h3",{className:"text-text-secondary text-sm font-medium",children:"遅延あり"}),(0,l.jsx)("h2",{className:"text-status-danger text-2xl font-bold",children:s.delayed_projects})]}),(0,l.jsxs)("div",{className:"dashboard-card",children:[(0,l.jsx)("h3",{className:"text-text-secondary text-sm font-medium",children:"今月のマイルストーン"}),(0,l.jsx)("h2",{className:"text-status-warning text-2xl font-bold",children:s.milestone_projects})]})]})},E=e=>{let{progress:s,color:t}=e;return(0,l.jsxs)("div",{className:"progress-bar-container",children:[(0,l.jsx)("div",{className:"progress-bar",style:{width:"".concat(s,"%"),backgroundColor:t}}),(0,l.jsxs)("div",{className:"progress-text",children:[s.toFixed(1),"%"]})]})},P=t(9077),F=e=>{let{projectId:s,filePath:t}=e,{data:r,isLoading:a,error:c}=(0,P.useQuery)(["recentTasks",s,t],()=>d(s,t),{staleTime:3e5});return a?(0,l.jsxs)("div",{className:"animate-pulse space-y-2",children:[(0,l.jsx)("div",{className:"h-4 bg-gray-700 rounded w-3/4"}),(0,l.jsx)("div",{className:"h-4 bg-gray-700 rounded w-2/3"}),(0,l.jsx)("div",{className:"h-4 bg-gray-700 rounded w-1/2"})]}):c||!r?(0,l.jsx)("div",{className:"text-status-danger italic text-sm",children:"データ取得エラー"}):(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold text-status-danger",children:"遅延中: "}),r.delayed?(0,l.jsx)("span",{className:"text-text-primary",children:r.delayed.name}):(0,l.jsx)("span",{className:"italic text-text-secondary",children:"なし"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold text-status-info",children:"進行中: "}),r.in_progress?(0,l.jsx)("span",{className:"text-text-primary",children:r.in_progress.name}):(0,l.jsx)("span",{className:"italic text-text-secondary",children:"なし"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold text-text-accent",children:"次のタスク: "}),r.next_task?(0,l.jsx)("span",{className:"text-text-primary",children:r.next_task.name}):(0,l.jsx)("span",{className:"italic text-text-secondary",children:"なし"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-bold text-text-secondary",children:"次の次: "}),r.next_next_task?(0,l.jsx)("span",{className:"text-text-primary",children:r.next_next_task.name}):(0,l.jsx)("span",{className:"italic text-text-secondary",children:"なし"})]})]})},_=e=>{let{projects:s,isLoading:t,onOpenFile:r,filePath:a}=e;if(t)return(0,l.jsxs)("div",{className:"dashboard-card",children:[(0,l.jsx)("h2",{className:"text-text-primary text-lg font-medium mb-4",children:"プロジェクト一覧"}),(0,l.jsx)("div",{className:"animate-pulse space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,l.jsx)("div",{className:"h-16 bg-gray-700 rounded"},s))})]});if(!s||0===s.length)return(0,l.jsxs)("div",{className:"dashboard-card",children:[(0,l.jsx)("h2",{className:"text-text-primary text-lg font-medium mb-4",children:"プロジェクト一覧"}),(0,l.jsx)("div",{className:"text-text-secondary text-center py-8",children:"プロジェクトがありません"})]});let c=(e,s)=>s?"#ff5f5f":e>=90?"#50ff96":e>=70?"#60cdff":e>=50?"#ffeb45":"#c8c8c8";return(0,l.jsxs)("div",{className:"dashboard-card",children:[(0,l.jsx)("h2",{className:"text-text-primary text-lg font-medium mb-4",children:"プロジェクト一覧"}),(0,l.jsx)("div",{className:"overflow-x-auto max-h-[600px] overflow-y-auto",children:(0,l.jsxs)("table",{className:"dashboard-table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"プロジェクト"}),(0,l.jsx)("th",{children:"工程"}),(0,l.jsx)("th",{children:"ライン"}),(0,l.jsx)("th",{className:"text-center",children:"進捗"}),(0,l.jsx)("th",{children:"状態"}),(0,l.jsx)("th",{children:"次のマイルストーン"}),(0,l.jsx)("th",{className:"text-center",children:"タスク進捗"}),(0,l.jsx)("th",{children:"直近のタスク"}),(0,l.jsx)("th",{className:"text-center",children:"リンク"})]})}),(0,l.jsx)("tbody",{children:s.map(e=>{let s=c(e.progress,!1),t=e.progress<100?"進行中":"完了";return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"min-w-[150px]",children:e.project_name}),(0,l.jsx)("td",{className:"min-w-[100px]",children:e.process}),(0,l.jsx)("td",{className:"min-w-[100px]",children:e.line}),(0,l.jsx)("td",{className:"min-w-[150px] text-center",children:(0,l.jsx)(E,{progress:e.progress,color:s})}),(0,l.jsx)("td",{className:"min-w-[100px] ".concat("text-text-primary"),children:t}),(0,l.jsx)("td",{className:"min-w-[200px]",children:"-"}),(0,l.jsxs)("td",{className:"min-w-[100px] text-center",children:[e.completed_tasks,"/",e.total_tasks]}),(0,l.jsx)("td",{className:"min-w-[300px] max-w-[400px]",children:(0,l.jsx)(F,{projectId:e.project_id,filePath:a})}),(0,l.jsx)("td",{className:"min-w-[200px] text-center whitespace-nowrap",children:(0,l.jsxs)("div",{className:"flex gap-2 justify-center",children:[e.project_path&&(0,l.jsx)("button",{onClick:()=>r(e.project_path),className:"link-button",children:"フォルダを開く"}),e.ganttchart_path&&(0,l.jsx)("button",{onClick:()=>r(e.ganttchart_path),className:"link-button",children:"工程表を開く"})]})})]},e.project_id)})})]})})]})},A=e=>{let{onRetry:s,ports:t,attempts:a,lastError:c}=e,[n,o]=(0,r.useState)(!1),[i,d]=(0,r.useState)(!1),[x,m]=(0,r.useState)(0);(0,r.useEffect)(()=>{if(a<=3){let e=30-5*a;m(e);let s=setInterval(()=>{m(e=>e<=1?(clearInterval(s),h(),0):e-1)},1e3);return()=>clearInterval(s)}},[a]);let h=async()=>{if(!n){o(!0);try{await s()}finally{o(!1)}}};return(0,l.jsx)("div",{className:"dashboard-card bg-red-900 bg-opacity-20 p-6",children:(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-red-500 mr-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-white mb-2",children:"バックエンドサーバーに接続できません"}),(0,l.jsxs)("div",{className:"bg-gray-800 p-4 rounded-md mb-4 text-gray-300",children:[(0,l.jsx)("p",{children:"以下のポートへの接続を試みましたが、成功しませんでした:"}),(0,l.jsx)("p",{className:"font-mono mt-2",children:t.join(", ")}),(0,l.jsxs)("p",{className:"mt-2",children:["接続試行回数: ",a]}),c&&(0,l.jsxs)("p",{className:"mt-2 text-red-300",children:["エラー: ",c]})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"font-bold text-yellow-300 mb-1",children:"考えられる原因:"}),(0,l.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-white",children:[(0,l.jsx)("li",{children:"バックエンドサーバーが起動していない"}),(0,l.jsx)("li",{children:"ポートが他のアプリケーションによって使用されている"}),(0,l.jsx)("li",{children:"ファイアウォールがブロックしている"}),(0,l.jsx)("li",{children:"セキュリティソフトウェアが接続を妨げている"})]})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h3",{className:"font-bold text-green-300 mb-1",children:"解決策:"}),(0,l.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-white",children:[(0,l.jsx)("li",{children:"アプリケーションを完全に終了して再起動する"}),(0,l.jsx)("li",{children:"タスクマネージャーを開き、Python関連のプロセスを終了する"}),(0,l.jsx)("li",{children:"ポート8000, 8080を使用している他のアプリケーションを確認して終了する"}),(0,l.jsx)("li",{children:"管理者権限でアプリケーションを実行する"})]})]}),(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("button",{onClick:()=>d(!i),className:"text-blue-300 hover:text-blue-100 underline",children:i?"診断情報を隠す":"診断情報を表示"}),i&&(0,l.jsxs)("div",{className:"mt-2 bg-gray-800 p-3 rounded-md text-sm",children:[(0,l.jsx)("p",{className:"text-white font-medium mb-2",children:"接続診断:"}),(0,l.jsxs)("p",{className:"text-gray-300",children:["試行されたポート: ",t.join(", ")]}),(0,l.jsxs)("p",{className:"text-gray-300",children:["接続試行回数: ",a]}),(0,l.jsxs)("p",{className:"text-gray-300",children:["最後のエラー: ",c||"情報なし"]}),(0,l.jsx)("p",{className:"text-gray-300 mt-2",children:"ブラウザネットワーク状態:"}),(0,l.jsxs)("p",{className:"text-gray-300",children:["オンライン: ",navigator.onLine?"はい":"いいえ"]}),(0,l.jsxs)("div",{className:"mt-3 text-yellow-300",children:[(0,l.jsx)("p",{children:"推奨されるトラブルシューティング:"}),(0,l.jsxs)("ol",{className:"list-decimal list-inside ml-2 text-gray-200",children:[(0,l.jsx)("li",{children:"アプリケーションを完全に終了し、再起動する"}),(0,l.jsx)("li",{children:"タスクマネージャーでpythonプロセスを強制終了する"}),(0,l.jsx)("li",{children:"ポートスキャンツールでポート8000, 8080の状態を確認する"}),(0,l.jsx)("li",{children:"ファイアウォール設定でアプリケーションを許可する"}),(0,l.jsx)("li",{children:"管理者権限でアプリケーションを実行する"})]})]})]})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,l.jsx)("p",{className:"text-gray-400 text-sm",children:a<=3&&x>0?"".concat(x,"秒後に自動的に再試行します..."):a<=3?"自動再試行を実行中...":"自動再試行の制限に達しました。手動で再試行してください。"}),(0,l.jsx)("button",{onClick:h,disabled:n,className:"bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded transition-colors ".concat(n?"opacity-50 cursor-not-allowed":""),children:n?"接続中...":"接続を再試行"})]})]})]})})},L=e=>{let{message:s,details:t,onRetry:a}=e,[c,n]=(0,r.useState)(!1);return(0,l.jsxs)("div",{className:"dashboard-card bg-red-900 bg-opacity-20 mb-4",children:[(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-500 mr-3 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h3",{className:"text-red-400 font-medium",children:"エラーが発生しました"}),(0,l.jsx)("p",{className:"mt-1 text-white",children:s}),t&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsxs)("button",{onClick:()=>n(!c),className:"text-red-300 text-sm hover:text-red-100 flex items-center",children:[c?"詳細を隠す":"詳細を表示",(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-1 transition-transform ".concat(c?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&(0,l.jsx)("pre",{className:"mt-2 p-3 bg-gray-800 rounded text-xs overflow-auto max-h-40 text-gray-300",children:"string"==typeof t?t:JSON.stringify(t,null,2)})]})]})]}),a&&(0,l.jsx)("div",{className:"mt-4 flex justify-end",children:(0,l.jsx)("button",{onClick:a,className:"bg-red-600 hover:bg-red-700 text-white text-sm py-1 px-3 rounded transition-colors",children:"再試行"})})]})},D=e=>{let{onRetry:s}=e,[t,a]=(0,r.useState)(!1),[c,o]=(0,r.useState)(0),{status:i,reconnectAttempts:d,checkConnection:x}=(0,v.h)();(0,r.useEffect)(()=>{if(!n.C5)return;let e=!0;if(!i.connected&&i.message.includes("接続できません")){if(d<3){let s=15-5*d;o(s);let t=setInterval(()=>{e&&o(e=>e<=1?(clearInterval(t),m(),0):e-1)},1e3);return()=>{clearInterval(t),e=!1}}return()=>{e=!1}}},[i.connected,i.message,d]);let m=async()=>{if(!t){a(!0);try{await x(),s()}finally{a(!1)}}};return i.connected&&!i.loading?(0,l.jsxs)("div",{className:"mb-4 flex items-center text-xs text-green-500",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"APIサーバーに接続中"]}):i.loading&&0===d?(0,l.jsx)("div",{className:"mb-4 p-3 rounded bg-gray-700",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"animate-spin w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full mr-3"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium text-white",children:"バックエンドサーバーに接続中..."}),(0,l.jsx)("p",{className:"text-sm text-gray-300",children:"サーバーの起動を待っています。しばらくお待ちください。"})]})]})}):(0,l.jsxs)("div",{className:"mb-4 p-3 rounded bg-red-900 bg-opacity-30",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[i.loading?(0,l.jsx)("div",{className:"animate-spin w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full mr-3"}):(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 text-red-500 mr-3",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium text-white",children:i.loading?"API接続確認中...":"API接続エラー"}),(0,l.jsx)("p",{className:"text-sm text-gray-300",children:i.message}),c>0&&(0,l.jsxs)("p",{className:"text-xs text-blue-300 mt-1",children:[c,"秒後に自動的に再接続します..."]})]})]}),!i.loading&&(0,l.jsx)("button",{onClick:m,disabled:t,className:"bg-white text-gray-800 px-3 py-1 rounded text-sm transition-colors ".concat(t?"opacity-50 cursor-not-allowed":"hover:bg-gray-200"),children:t?"再接続中...":"再接続"})]}),!i.loading&&(0,l.jsxs)("div",{className:"mt-2 text-xs text-gray-400",children:[(0,l.jsx)("p",{children:"考えられる原因:"}),(0,l.jsxs)("ul",{className:"list-disc list-inside ml-2 mt-1",children:[(0,l.jsx)("li",{children:"バックエンドサーバーが起動中です - しばらくお待ちください"}),(0,l.jsx)("li",{children:"バックエンドサーバーが別のポートで実行されています"}),(0,l.jsx)("li",{children:"ファイアウォールがブロックしています"}),(0,l.jsx)("li",{children:"サーバープロセスが終了した可能性があります"})]}),d>=3&&(0,l.jsxs)("div",{className:"mt-2 p-2 border border-yellow-600 rounded text-yellow-300",children:[(0,l.jsx)("p",{className:"font-medium",children:"自動再接続に複数回失敗しました。"}),(0,l.jsx)("p",{className:"mt-1",children:"アプリケーションを再起動するか、ポート設定を確認してください。"}),(0,l.jsxs)("p",{className:"mt-1",children:["接続試行回数: ",d]})]}),i.connected||i.loading||!(d>1)?null:(0,l.jsxs)("div",{className:"mt-4 p-3 bg-gray-800 rounded-md",children:[(0,l.jsx)("h4",{className:"text-yellow-400 text-sm font-medium mb-2",children:"トラブルシューティング:"}),(0,l.jsxs)("ol",{className:"list-decimal list-inside text-gray-300 space-y-1 text-sm",children:[(0,l.jsxs)("li",{children:["アプリケーションを",(0,l.jsx)("strong",{children:"完全に終了"}),"して再起動してください"]}),(0,l.jsx)("li",{children:"タスクマネージャーでPython関連プロセスを確認し、終了してください"}),(0,l.jsx)("li",{children:"ポート8000、8080が他のアプリで使用されていないか確認してください"}),(0,l.jsx)("li",{children:"管理者権限でアプリケーションを実行してみてください"})]})]})]})]})};let R=(0,r.lazy)(()=>Promise.all([t.e(674),t.e(531),t.e(309)]).then(t.bind(t,6309))),O=()=>{let[e,s]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(n.C5&&window.electron)s(!0),window.electronReady=!0;else{let e=()=>{s(!0),window.electronReady=!0};return document.addEventListener("electron-ready",e),document.addEventListener("app-init",e),()=>{document.removeEventListener("electron-ready",e),document.removeEventListener("app-init",e)}}},[]),{isElectronReady:e}};function T(){var e;let[s,t]=(0,r.useState)(null),[a,c]=(0,r.useState)(!0),[o,i]=(0,r.useState)(null),[d,m]=(0,r.useState)(0),[h,u]=(0,r.useState)([]),{addNotification:p}=(0,f.l)(),{isElectronReady:g}=O(),{status:y,reconnectAttempts:w,checkConnection:N}=(0,v.h)(),{projects:S,metrics:C,isLoading:E,error:P,refreshData:F,openFile:T}=b(s);(0,r.useEffect)(()=>{let e=!0,s=setTimeout(()=>{e&&a&&c(!1)},1e4),l=async()=>{try{if(!e)return;if(m(e=>e+1),u([8e3,8080,8888,8081,8001,3001,5e3]),n.C5&&!g&&window.electron&&console.log("Electron API準備中、初期化を待機します..."),n.C5)try{let e=localStorage.getItem("lastSelectedPath");e&&(console.log("前回のファイルパスをロード:",e),t(e))}catch(e){console.warn("LocalStorageからの読み込みエラー:",e)}let s=N();await new Promise(e=>setTimeout(e,100));try{let e=await x();if(e.success&&e.path){if(t(e.path),n.C5)try{localStorage.setItem("lastSelectedPath",e.path)}catch(e){console.warn("LocalStorageへの保存エラー:",e)}p("デフォルトファイルを読み込みました","success")}else console.log("デフォルトファイルパスが取得できませんでした")}catch(e){console.warn("デフォルトファイルパス取得エラー:",e)}let l=await s;l||(i({message:"バックエンドサーバーに接続できません。",details:{reason:"別のアプリケーションがAPIポートを使用している可能性があります。",solution:"アプリケーションを再起動するか、使用中のアプリケーションを終了してから再試行してください。"}}),p("バックエンドサーバーに接続できません。","error"))}catch(s){console.error("アプリケーション初期化エラー:",s),e&&(i({message:"アプリケーションの初期化中にエラーが発生しました。APIサーバーに接続できません。",details:s}),p("APIサーバーに接続できません。","error"))}finally{e&&(c(!1),clearTimeout(s))}};return l(),()=>{e=!1,clearTimeout(s)}},[p,N,g]);let M=async()=>{m(e=>e+1),c(!0),i(null);try{let e=Math.min(500*d,2e3);p("バックエンドサーバーへの接続を再試行しています...(".concat(e,"ms 待機)"),"info"),await new Promise(s=>setTimeout(s,e));let s=await j();if(s.success){p("APIサーバーに接続しました","success");let e=await x();e.success&&e.path&&(t(e.path),p("デフォルトファイルを読み込みました","success"))}else i({message:"バックエンドサーバーに接続できません。",details:s.details}),d>=3?p("複数回の接続試行に失敗しました。アプリケーションを再起動してください。","error"):p("APIサーバーに接続できません。","error")}catch(e){console.error("接続再試行エラー:",e),i({message:"APIサーバーに接続できません。",details:e}),p("APIサーバーへの接続試行中にエラーが発生しました。","error")}finally{c(!1)}},V=async()=>{try{p("バックエンドサーバーへの再接続を試みています...","info"),await N()}catch(e){console.error("API再接続エラー:",e),p("バックエンドサーバーへの再接続に失敗しました","error")}};return(0,l.jsxs)("main",{className:"min-h-screen bg-background",children:[(0,l.jsx)(I,{updateTime:(null==C?void 0:C.last_updated)||"更新情報がありません",onRefresh:F,selectedFilePath:s,onSelectFile:e=>{if(t(e),n.C5)try{localStorage.setItem("lastSelectedPath",e)}catch(e){console.warn("LocalStorageへの保存エラー:",e)}}}),(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[(0,l.jsx)(D,{onRetry:V}),!a&&o&&o.message.includes("接続できません")?(0,l.jsx)(A,{onRetry:M,ports:h,attempts:d,lastError:null===(e=o.details)||void 0===e?void 0:e.message}):!a&&o?(0,l.jsx)(L,{message:o.message,details:o.details,onRetry:M}):null,P&&(0,l.jsx)(L,{message:P.message,details:P.details,onRetry:F}),C&&(0,l.jsx)(k,{summary:C.summary,isLoading:E}),(0,l.jsx)(_,{projects:S||[],isLoading:E,onOpenFile:T,filePath:s||void 0}),C&&(0,l.jsx)(r.Suspense,{fallback:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsx)("div",{className:"dashboard-card h-80 flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-pulse text-text-secondary",children:"グラフをロード中..."})}),(0,l.jsx)("div",{className:"dashboard-card h-80 flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-pulse text-text-secondary",children:"グラフをロード中..."})})]}),children:(0,l.jsx)(R,{metrics:C,isLoading:E})}),!1]})]})}},4033:function(e,s,t){e.exports=t(94)}},function(e){e.O(0,[17,282,971,472,744],function(){return e(e.s=7821)}),_N_E=e.O()}]);