(()=>{var e={};e.id=931,e.ids=[931],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},6113:e=>{"use strict";e.exports=require("crypto")},7006:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>h,tree:()=>i});var r=t(7096),l=t(6132),a=t(7284),n=t.n(a),c=t(2564),o={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>c[e]);t.d(s,o);let i=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,3982)),"C:\\Users\\gbrai\\Documents\\Projects\\project-dashboard_ctg\\frontend\\app\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,7897)),"C:\\Users\\gbrai\\Documents\\Projects\\project-dashboard_ctg\\frontend\\app\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,8196)),"C:\\Users\\gbrai\\Documents\\Projects\\project-dashboard_ctg\\frontend\\app\\error.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,8734)),"C:\\Users\\gbrai\\Documents\\Projects\\project-dashboard_ctg\\frontend\\app\\loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,4293)),"C:\\Users\\gbrai\\Documents\\Projects\\project-dashboard_ctg\\frontend\\app\\not-found.tsx"]}],d=["C:\\Users\\gbrai\\Documents\\Projects\\project-dashboard_ctg\\frontend\\app\\page.tsx"],x="/page",m={require:t,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:l.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:i}})},5214:(e,s,t)=>{Promise.resolve().then(t.bind(t,8363))},8363:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>M});var r=t(3854),l=t(4218),a=t(2417),n=t(8601),c=t(2747);let o=async e=>{if(!c.C5)throw Error("This function can only be called in client-side code");return(0,c.DA)()||await (0,n.qN)(),e()},i=async e=>o(async()=>{try{console.log(`初期データ取得中... filePath: ${e||"なし"}`);let[s,t]=await Promise.allSettled([a.apiClient.get("/metrics",{file_path:e}),a.apiClient.get("/projects",{file_path:e})]),r={};return"fulfilled"===s.status&&(r.metrics=s.value),"fulfilled"===t.status&&(r.projects=t.value),"rejected"===s.status&&"rejected"===t.status&&(r.error=s.reason),r}catch(e){return console.error("初期データ取得失敗:",e),{error:e}}}),d=async(e,s)=>o(async()=>{try{console.log(`最近のタスク取得中... projectId: ${e}, filePath: ${s||"なし"}`);let t=await a.apiClient.get(`/projects/${e}/recent-tasks`,{file_path:s});return console.log("最近のタスク取得成功"),t}catch(e){throw console.error("最近のタスク取得失敗:",e),e}}),x=async()=>o(async()=>{try{console.log("デフォルトファイルパス取得中...");let e=await a.apiClient.get("/files/default-path");return console.log(`デフォルトファイルパス取得成功: ${e.path||"パスなし"}`),e}catch(e){return console.error("デフォルトファイルパス取得失敗:",e),{success:!1,message:e.isApiError?`デフォルトパス取得エラー: ${e.details}`:`デフォルトパス取得中に予期しないエラーが発生しました: ${e.message}`,path:null}}}),m=async e=>o(async()=>{try{console.log(`ファイルを開く... path: ${e}`);let s=await a.apiClient.post("/files/open",{path:e});return console.log(`ファイルを開く成功: ${s.success?"成功":"失敗"}`),s}catch(e){return console.error("ファイルを開く失敗:",e),{success:!1,message:e.isApiError?`ファイルを開くエラー: ${e.details}`:`ファイルを開く際に予期しないエラーが発生しました: ${e.message}`,path:null}}}),h=null,u=0,p=async e=>{if(console.log("selectFile: 関数が呼び出されました",{initialPath:e}),!c.C5)return console.log("selectFile: クライアントサイドではありません"),{success:!1,message:"クライアント側でのみ使用可能な機能です",path:null};let s=Date.now();if(h&&s-u<6e4)return console.log("selectFile: キャッシュされた選択結果を再利用",h),h;try{console.log("selectFile: 環境を検証します");let t={isClient:c.C5,isElectron:(0,c.yv)(),hasElectronObj:void 0!==window.electron,hasDialogObj:void 0!==window.electron?.dialog,hasOpenCSVMethod:"function"==typeof window.electron?.dialog?.openCSVFile,nodeEnv:"production"};if(console.log("selectFile: 環境変数:",t),!t.isElectron||!t.hasOpenCSVMethod)return console.log("selectFile: APIベースのファイル選択を使用します"),await o(async()=>{console.log("selectFile: APIリクエスト開始: /files/select");let t=await a.apiClient.get("/files/select",{initial_path:e});return console.log("selectFile: API選択結果:",t),h=t,u=s,t});console.log("selectFile: Electron対応ファイル選択を使用します");try{console.log("selectFile: window.electron.dialog.openCSVFile を呼び出します");let t=await window.electron.dialog.openCSVFile(e||"");return console.log("selectFile: Electron選択結果:",t),h=t,u=s,t}catch(e){throw console.error("selectFile: Electronダイアログエラー:",e),e}}catch(e){return console.error("selectFile: エラー発生:",e),{success:!1,message:e.isApiError?`ファイル選択エラー: ${e.details}`:`ファイル選択中に予期しないエラーが発生しました: ${e.message}`,path:null}}},g=async()=>o(async()=>{try{console.log("APIヘルスチェック実行中...");let e=await a.apiClient.get("/health");return console.log("APIヘルスチェック成功:",e),e}catch(e){throw console.error("APIヘルスチェック失敗:",e),e}}),j=async()=>{if(!c.C5)return{success:!1,message:"クライアント側でのみ実行可能な機能です"};try{console.log("API接続テスト実行中...");let e=await g();return{success:!0,message:`APIサーバーに接続しました: ${e.status||"OK"}`,details:e}}catch(e){return console.error("API接続テスト失敗:",e),{success:!1,message:e.isApiError?`接続エラー: ${e.details}`:`API接続テスト中に予期しないエラーが発生しました: ${e.message}`,details:e}}};var f=t(9585),y=t(1780);let b=e=>{if(!c.C5||!(0,c.yv)()){console.log("Electronディスパッチャの初期化をスキップ: 対象環境ではありません");return}console.log("Electronディスパッチャの初期化: リスナーを登録");let s=window.electron?.ipcRenderer.on("api-connection-established",e.onConnectionEstablished),t=window.electron?.ipcRenderer.on("api-server-down",e.onServerDown),r=window.electron?.ipcRenderer.on("api-server-restarted",e.onServerRestarted);return()=>{console.log("Electronディスパッチャのクリーンアップ: リスナーを解除"),s&&s(),t&&t(),r&&r()}},v=(e,s)=>{if(c.C5)try{localStorage.setItem(`dashboard_${e}_timestamp`,Date.now().toString()),localStorage.setItem(`dashboard_${e}`,JSON.stringify(s))}catch(s){console.warn(`データ保存エラー (${e}):`,s)}},w=(e,s=36e5)=>{if(!c.C5)return null;try{let t=localStorage.getItem(`dashboard_${e}_timestamp`);if(!t)return null;let r=Date.now()-parseInt(t);if(r>s)return null;let l=localStorage.getItem(`dashboard_${e}`);return l?JSON.parse(l):null}catch(s){return console.warn(`データ読み込みエラー (${e}):`,s),null}},N=e=>{let[s,t]=(0,l.useState)(null),[r,a]=(0,l.useState)(null),[n,o]=(0,l.useState)(!1),[d,x]=(0,l.useState)(null),{addNotification:h}=(0,f.l)(),[u,p]=(0,l.useState)(!1),{status:g,reconnectAttempts:j,checkConnection:N}=(0,y.h)();(0,l.useEffect)(()=>{if(!c.C5||!(0,c.yv)())return;let s=b({onConnectionEstablished:s=>{console.log("API接続確立:",s),h(`APIサーバーへの接続が確立されました (ポート: ${s.port})`,"success"),e&&S()},onServerDown:e=>{console.error("APIサーバーダウン:",e),h(e.message||"バックエンドサーバーが応答していません","error"),x({message:"バックエンドサーバーが応答していません",details:{message:e.message,time:new Date().toISOString()}})},onServerRestarted:s=>{console.log("APIサーバー再起動:",s),h(`バックエンドサーバーが再起動しました (ポート: ${s.port})`,"info"),e&&setTimeout(()=>S(),1e3)}});return()=>{s&&s()}},[h,e]),(0,l.useEffect)(()=>{if(!c.C5||u)return;let e=w("projects"),s=w("metrics");e&&(t(e),console.log("キャッシュからプロジェクトデータを復元")),s&&(a(s),console.log("キャッシュからメトリクスデータを復元")),p(!0)},[u]);let S=(0,l.useCallback)(async()=>{if(c.C5){if(!e){h("ファイルが選択されていません","error");return}if(!g.connected){let e=await N();if(!e)return}o(!0),x(null);try{let s=await i(e);if(s.projects&&(t(s.projects),v("projects",s.projects)),s.metrics&&(a(s.metrics),v("metrics",s.metrics)),s.error)throw s.error}catch(t){let e=t.message||"データの取得中にエラーが発生しました",s=t.details||t;console.error("データ取得エラー:",t),x({message:e,details:s}),h(e,"error")}finally{o(!1)}}},[e,h,g.connected,N]);(0,l.useEffect)(()=>{c.C5&&e&&g.connected&&S()},[e,S,g.connected]);let C=(0,l.useCallback)(async()=>{if(c.C5){if(!e){h("ファイルが選択されていません","error");return}try{await S(),d||h("データが更新されました","success")}catch(e){console.error("データ更新エラー:",e)}}},[e,S,h,d]),P=(0,l.useCallback)(async e=>{if(c.C5)try{let s=await m(e);s.success?h("ファイルを開きました","success"):h(s.message||"ファイルを開けませんでした","error")}catch(s){let e=s.message||"ファイルを開く際にエラーが発生しました";console.error("ファイルを開く際のエラー:",s),h(e,"error")}},[h]);return(0,l.useEffect)(()=>{if(!c.C5||!e||!g.connected)return;let s=null,t=!0,r=()=>{document.hidden?(s&&(clearInterval(s),s=null),t=!1):(t||(S(),l()),t=!0)},l=()=>{s&&clearInterval(s),s=setInterval(()=>{t&&S()},3e5)};return document.addEventListener("visibilitychange",r),l(),()=>{document.removeEventListener("visibilitychange",r),s&&clearInterval(s)}},[e,g.connected,S]),{projects:s,metrics:r,isLoading:n,apiStatus:g,reconnectAttempts:j,error:d,refreshData:C,fetchData:S,openFile:P,checkApiConnection:N}};var S=t(1018);let C=({onSelectFile:e,selectedFilePath:s})=>{let{addNotification:t}=(0,f.l)(),[a,n]=(0,l.useState)(!1),[o,i]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=(0,c.yv)();i(e),console.log("FileSelector: Electron環境の検出結果:",e,{windowElectron:window.electron?"存在します":"存在しません",windowElectronDialog:window.electron?.dialog?"存在します":"存在しません"})},[]);let d=async()=>{console.log("FileSelector: handleSelectFile が呼び出されました"),n(!0);try{console.log("FileSelector: selectFile を呼び出します...");let r=await p(s||void 0);console.log("FileSelector: selectFile の結果:",r),r.success&&r.path?(console.log("FileSelector: ファイル選択成功:",r.path),e(r.path),t(`ファイルを選択しました: ${r.path}`,"success")):(console.log("FileSelector: ファイル選択失敗または中断:",r.message),r.message&&t(r.message,"error"))}catch(e){console.error("FileSelector: ファイル選択エラー:",e),t("ファイルの選択中にエラーが発生しました","error")}finally{console.log("FileSelector: handleSelectFile 完了"),n(!1)}},x=async()=>{if(console.log("FileSelector: testElectronDialog が呼び出されました"),(0,c.yv)()&&window.electron?.testDialog)try{console.log("FileSelector: Electron testDialog を実行...");let e=await window.electron.testDialog();console.log("FileSelector: testDialog 結果:",e),t("ダイアログテスト: "+(e.success?"成功":"失敗"),e.success?"success":"error")}catch(e){console.error("FileSelector: ダイアログテストエラー:",e),t("ダイアログテストエラー","error")}else console.log("FileSelector: Electron環境が検出されませんでした"),t("Electron環境が検出されませんでした","error")};return(0,r.jsxs)("div",{className:"flex items-center flex-wrap",children:[s&&(0,r.jsxs)("div",{className:"text-text-secondary text-xs mr-2 max-w-xs truncate mb-2",children:["現在のファイル: ",s]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("button",{onClick:d,disabled:a,className:"bg-transparent text-text-accent px-2.5 py-1.5 rounded border border-text-accent text-xs hover:bg-text-accent hover:text-surface transition-colors disabled:opacity-50 disabled:cursor-not-allowed","data-testid":"file-select-button",children:[a?"選択中...":"参照"," ",o?"(E)":"(A)"]}),r.jsx("button",{onClick:x,className:"bg-transparent text-purple-400 px-2.5 py-1.5 rounded border border-purple-400 text-xs hover:bg-purple-400 hover:text-surface transition-colors",children:"診断"}),r.jsx("button",{onClick:()=>{console.log("FileSelector: handleManualInput が呼び出されました");let r=prompt("CSVファイルの完全パスを入力してください:",s||"");r&&(e(r),t(`ファイルパスを手動で設定しました: ${r}`,"success"))},className:"bg-transparent text-gray-400 px-2.5 py-1.5 rounded border border-gray-400 text-xs hover:bg-gray-400 hover:text-surface transition-colors",children:"パスを入力"})]})]})},P=({updateTime:e,onRefresh:s,selectedFilePath:t,onSelectFile:a})=>{(0,S.usePathname)();let{addNotification:n}=(0,f.l)(),[c,o]=(0,l.useState)(!1);return r.jsx("header",{className:"bg-surface border-b border-opacity-10 border-white shadow-md",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"プロジェクト進捗ダッシュボード"}),r.jsx("p",{className:"text-text-secondary text-sm",children:e})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(C,{onSelectFile:e=>{console.log("Header: handleSelectFile が呼び出されました",{path:e}),a(e)},selectedFilePath:t}),r.jsx("button",{onClick:s,className:"bg-text-accent text-surface px-2.5 py-1.5 rounded text-xs hover:bg-opacity-80 transition-colors ml-2",children:"更新"})]})]})})},_=({summary:e,isLoading:s})=>s?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,r.jsxs)("div",{className:"bg-surface rounded-lg shadow-card p-4 animate-pulse h-24",children:[r.jsx("div",{className:"h-4 bg-gray-700 rounded w-1/2 mb-2"}),r.jsx("div",{className:"h-8 bg-gray-700 rounded w-1/4"})]},s))}):(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"dashboard-card",children:[r.jsx("h3",{className:"text-text-secondary text-sm font-medium",children:"総プロジェクト数"}),r.jsx("h2",{className:"text-text-primary text-2xl font-bold",children:e.total_projects})]}),(0,r.jsxs)("div",{className:"dashboard-card",children:[r.jsx("h3",{className:"text-text-secondary text-sm font-medium",children:"進行中"}),r.jsx("h2",{className:"text-status-info text-2xl font-bold",children:e.active_projects})]}),(0,r.jsxs)("div",{className:"dashboard-card",children:[r.jsx("h3",{className:"text-text-secondary text-sm font-medium",children:"遅延あり"}),r.jsx("h2",{className:"text-status-danger text-2xl font-bold",children:e.delayed_projects})]}),(0,r.jsxs)("div",{className:"dashboard-card",children:[r.jsx("h3",{className:"text-text-secondary text-sm font-medium",children:"今月のマイルストーン"}),r.jsx("h2",{className:"text-status-warning text-2xl font-bold",children:e.milestone_projects})]})]}),k=({progress:e,color:s})=>(0,r.jsxs)("div",{className:"progress-bar-container",children:[r.jsx("div",{className:"progress-bar",style:{width:`${e}%`,backgroundColor:s}}),(0,r.jsxs)("div",{className:"progress-text",children:[e.toFixed(1),"%"]})]});var E=t(4206);let I=({projectId:e,filePath:s})=>{let{data:t,isLoading:l,error:a}=(0,E.useQuery)(["recentTasks",e,s],()=>d(e,s),{staleTime:3e5});return l?(0,r.jsxs)("div",{className:"animate-pulse space-y-2",children:[r.jsx("div",{className:"h-4 bg-gray-700 rounded w-3/4"}),r.jsx("div",{className:"h-4 bg-gray-700 rounded w-2/3"}),r.jsx("div",{className:"h-4 bg-gray-700 rounded w-1/2"})]}):a||!t?r.jsx("div",{className:"text-status-danger italic text-sm",children:"データ取得エラー"}):(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-bold text-status-danger",children:"遅延中: "}),t.delayed?r.jsx("span",{className:"text-text-primary",children:t.delayed.name}):r.jsx("span",{className:"italic text-text-secondary",children:"なし"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-bold text-status-info",children:"進行中: "}),t.in_progress?r.jsx("span",{className:"text-text-primary",children:t.in_progress.name}):r.jsx("span",{className:"italic text-text-secondary",children:"なし"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-bold text-text-accent",children:"次のタスク: "}),t.next_task?r.jsx("span",{className:"text-text-primary",children:t.next_task.name}):r.jsx("span",{className:"italic text-text-secondary",children:"なし"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"font-bold text-text-secondary",children:"次の次: "}),t.next_next_task?r.jsx("span",{className:"text-text-primary",children:t.next_next_task.name}):r.jsx("span",{className:"italic text-text-secondary",children:"なし"})]})]})},F=({projects:e,isLoading:s,onOpenFile:t,filePath:l})=>{if(s)return(0,r.jsxs)("div",{className:"dashboard-card",children:[r.jsx("h2",{className:"text-text-primary text-lg font-medium mb-4",children:"プロジェクト一覧"}),r.jsx("div",{className:"animate-pulse space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>r.jsx("div",{className:"h-16 bg-gray-700 rounded"},s))})]});if(!e||0===e.length)return(0,r.jsxs)("div",{className:"dashboard-card",children:[r.jsx("h2",{className:"text-text-primary text-lg font-medium mb-4",children:"プロジェクト一覧"}),r.jsx("div",{className:"text-text-secondary text-center py-8",children:"プロジェクトがありません"})]});let a=(e,s)=>s?"#ff5f5f":e>=90?"#50ff96":e>=70?"#60cdff":e>=50?"#ffeb45":"#c8c8c8";return(0,r.jsxs)("div",{className:"dashboard-card",children:[r.jsx("h2",{className:"text-text-primary text-lg font-medium mb-4",children:"プロジェクト一覧"}),r.jsx("div",{className:"overflow-x-auto max-h-[600px] overflow-y-auto",children:(0,r.jsxs)("table",{className:"dashboard-table",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{children:[r.jsx("th",{children:"プロジェクト"}),r.jsx("th",{children:"工程"}),r.jsx("th",{children:"ライン"}),r.jsx("th",{className:"text-center",children:"進捗"}),r.jsx("th",{children:"状態"}),r.jsx("th",{children:"次のマイルストーン"}),r.jsx("th",{className:"text-center",children:"タスク進捗"}),r.jsx("th",{children:"直近のタスク"}),r.jsx("th",{className:"text-center",children:"リンク"})]})}),r.jsx("tbody",{children:e.map(e=>{let s=a(e.progress,!1),n=e.progress<100?"進行中":"完了";return(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"min-w-[150px]",children:e.project_name}),r.jsx("td",{className:"min-w-[100px]",children:e.process}),r.jsx("td",{className:"min-w-[100px]",children:e.line}),r.jsx("td",{className:"min-w-[150px] text-center",children:r.jsx(k,{progress:e.progress,color:s})}),r.jsx("td",{className:"min-w-[100px] text-text-primary",children:n}),r.jsx("td",{className:"min-w-[200px]",children:"-"}),(0,r.jsxs)("td",{className:"min-w-[100px] text-center",children:[e.completed_tasks,"/",e.total_tasks]}),r.jsx("td",{className:"min-w-[300px] max-w-[400px]",children:r.jsx(I,{projectId:e.project_id,filePath:l})}),r.jsx("td",{className:"min-w-[200px] text-center whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex gap-2 justify-center",children:[e.project_path&&r.jsx("button",{onClick:()=>t(e.project_path),className:"link-button",children:"フォルダを開く"}),e.ganttchart_path&&r.jsx("button",{onClick:()=>t(e.ganttchart_path),className:"link-button",children:"工程表を開く"})]})})]},e.project_id)})})]})})]})},A=({onRetry:e,ports:s,attempts:t,lastError:a})=>{let[n,c]=(0,l.useState)(!1),[o,i]=(0,l.useState)(!1),[d,x]=(0,l.useState)(0);(0,l.useEffect)(()=>{},[t]);let m=async()=>{if(!n){c(!0);try{await e()}finally{c(!1)}}};return r.jsx("div",{className:"dashboard-card bg-red-900 bg-opacity-20 p-6",children:(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-red-500 mr-4 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"バックエンドサーバーに接続できません"}),(0,r.jsxs)("div",{className:"bg-gray-800 p-4 rounded-md mb-4 text-gray-300",children:[r.jsx("p",{children:"以下のポートへの接続を試みましたが、成功しませんでした:"}),r.jsx("p",{className:"font-mono mt-2",children:s.join(", ")}),(0,r.jsxs)("p",{className:"mt-2",children:["接続試行回数: ",t]}),a&&(0,r.jsxs)("p",{className:"mt-2 text-red-300",children:["エラー: ",a]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("h3",{className:"font-bold text-yellow-300 mb-1",children:"考えられる原因:"}),(0,r.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-white",children:[r.jsx("li",{children:"バックエンドサーバーが起動していない"}),r.jsx("li",{children:"ポートが他のアプリケーションによって使用されている"}),r.jsx("li",{children:"ファイアウォールがブロックしている"}),r.jsx("li",{children:"セキュリティソフトウェアが接続を妨げている"})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("h3",{className:"font-bold text-green-300 mb-1",children:"解決策:"}),(0,r.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-white",children:[r.jsx("li",{children:"アプリケーションを完全に終了して再起動する"}),r.jsx("li",{children:"タスクマネージャーを開き、Python関連のプロセスを終了する"}),r.jsx("li",{children:"ポート8000, 8080を使用している他のアプリケーションを確認して終了する"}),r.jsx("li",{children:"管理者権限でアプリケーションを実行する"})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[r.jsx("button",{onClick:()=>i(!o),className:"text-blue-300 hover:text-blue-100 underline",children:o?"診断情報を隠す":"診断情報を表示"}),o&&(0,r.jsxs)("div",{className:"mt-2 bg-gray-800 p-3 rounded-md text-sm",children:[r.jsx("p",{className:"text-white font-medium mb-2",children:"接続診断:"}),(0,r.jsxs)("p",{className:"text-gray-300",children:["試行されたポート: ",s.join(", ")]}),(0,r.jsxs)("p",{className:"text-gray-300",children:["接続試行回数: ",t]}),(0,r.jsxs)("p",{className:"text-gray-300",children:["最後のエラー: ",a||"情報なし"]}),r.jsx("p",{className:"text-gray-300 mt-2",children:"ブラウザネットワーク状態:"}),(0,r.jsxs)("p",{className:"text-gray-300",children:["オンライン: ","不明"]}),(0,r.jsxs)("div",{className:"mt-3 text-yellow-300",children:[r.jsx("p",{children:"推奨されるトラブルシューティング:"}),(0,r.jsxs)("ol",{className:"list-decimal list-inside ml-2 text-gray-200",children:[r.jsx("li",{children:"アプリケーションを完全に終了し、再起動する"}),r.jsx("li",{children:"タスクマネージャーでpythonプロセスを強制終了する"}),r.jsx("li",{children:"ポートスキャンツールでポート8000, 8080の状態を確認する"}),r.jsx("li",{children:"ファイアウォール設定でアプリケーションを許可する"}),r.jsx("li",{children:"管理者権限でアプリケーションを実行する"})]})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[r.jsx("p",{className:"text-gray-400 text-sm",children:t<=3&&d>0?`${d}秒後に自動的に再試行します...`:t<=3?"自動再試行を実行中...":"自動再試行の制限に達しました。手動で再試行してください。"}),r.jsx("button",{onClick:m,disabled:n,className:`bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded transition-colors ${n?"opacity-50 cursor-not-allowed":""}`,children:n?"接続中...":"接続を再試行"})]})]})]})})},$=({message:e,details:s,onRetry:t})=>{let[a,n]=(0,l.useState)(!1);return(0,r.jsxs)("div",{className:"dashboard-card bg-red-900 bg-opacity-20 mb-4",children:[(0,r.jsxs)("div",{className:"flex items-start",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-500 mr-3 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-red-400 font-medium",children:"エラーが発生しました"}),r.jsx("p",{className:"mt-1 text-white",children:e}),s&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsxs)("button",{onClick:()=>n(!a),className:"text-red-300 text-sm hover:text-red-100 flex items-center",children:[a?"詳細を隠す":"詳細を表示",r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ml-1 transition-transform ${a?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&r.jsx("pre",{className:"mt-2 p-3 bg-gray-800 rounded text-xs overflow-auto max-h-40 text-gray-300",children:"string"==typeof s?s:JSON.stringify(s,null,2)})]})]})]}),t&&r.jsx("div",{className:"mt-4 flex justify-end",children:r.jsx("button",{onClick:t,className:"bg-red-600 hover:bg-red-700 text-white text-sm py-1 px-3 rounded transition-colors",children:"再試行"})})]})},D=({onRetry:e})=>{let[s,t]=(0,l.useState)(!1),[a,n]=(0,l.useState)(0),{status:o,reconnectAttempts:i,checkConnection:d}=(0,y.h)();(0,l.useEffect)(()=>{if(!c.C5)return;let e=!0;if(!o.connected&&o.message.includes("接続できません")){if(i<3){let s=15-5*i;n(s);let t=setInterval(()=>{e&&n(e=>e<=1?(clearInterval(t),x(),0):e-1)},1e3);return()=>{clearInterval(t),e=!1}}return()=>{e=!1}}},[o.connected,o.message,i]);let x=async()=>{if(!s){t(!0);try{await d(),e()}finally{t(!1)}}};return o.connected&&!o.loading?(0,r.jsxs)("div",{className:"mb-4 flex items-center text-xs text-green-500",children:[r.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"APIサーバーに接続中"]}):o.loading&&0===i?r.jsx("div",{className:"mb-4 p-3 rounded bg-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full mr-3"}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"font-medium text-white",children:"バックエンドサーバーに接続中..."}),r.jsx("p",{className:"text-sm text-gray-300",children:"サーバーの起動を待っています。しばらくお待ちください。"})]})]})}):(0,r.jsxs)("div",{className:"mb-4 p-3 rounded bg-red-900 bg-opacity-30",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[o.loading?r.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full mr-3"}):r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 text-red-500 mr-3",viewBox:"0 0 20 20",fill:"currentColor",children:r.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"font-medium text-white",children:o.loading?"API接続確認中...":"API接続エラー"}),r.jsx("p",{className:"text-sm text-gray-300",children:o.message}),a>0&&(0,r.jsxs)("p",{className:"text-xs text-blue-300 mt-1",children:[a,"秒後に自動的に再接続します..."]})]})]}),!o.loading&&r.jsx("button",{onClick:x,disabled:s,className:`bg-white text-gray-800 px-3 py-1 rounded text-sm transition-colors ${s?"opacity-50 cursor-not-allowed":"hover:bg-gray-200"}`,children:s?"再接続中...":"再接続"})]}),!o.loading&&(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-400",children:[r.jsx("p",{children:"考えられる原因:"}),(0,r.jsxs)("ul",{className:"list-disc list-inside ml-2 mt-1",children:[r.jsx("li",{children:"バックエンドサーバーが起動中です - しばらくお待ちください"}),r.jsx("li",{children:"バックエンドサーバーが別のポートで実行されています"}),r.jsx("li",{children:"ファイアウォールがブロックしています"}),r.jsx("li",{children:"サーバープロセスが終了した可能性があります"})]}),i>=3&&(0,r.jsxs)("div",{className:"mt-2 p-2 border border-yellow-600 rounded text-yellow-300",children:[r.jsx("p",{className:"font-medium",children:"自動再接続に複数回失敗しました。"}),r.jsx("p",{className:"mt-1",children:"アプリケーションを再起動するか、ポート設定を確認してください。"}),(0,r.jsxs)("p",{className:"mt-1",children:["接続試行回数: ",i]})]}),o.connected||o.loading||!(i>1)?null:(0,r.jsxs)("div",{className:"mt-4 p-3 bg-gray-800 rounded-md",children:[r.jsx("h4",{className:"text-yellow-400 text-sm font-medium mb-2",children:"トラブルシューティング:"}),(0,r.jsxs)("ol",{className:"list-decimal list-inside text-gray-300 space-y-1 text-sm",children:[(0,r.jsxs)("li",{children:["アプリケーションを",r.jsx("strong",{children:"完全に終了"}),"して再起動してください"]}),r.jsx("li",{children:"タスクマネージャーでPython関連プロセスを確認し、終了してください"}),r.jsx("li",{children:"ポート8000、8080が他のアプリで使用されていないか確認してください"}),r.jsx("li",{children:"管理者権限でアプリケーションを実行してみてください"})]})]})]})]})},L=(0,l.lazy)(()=>t.e(737).then(t.bind(t,3737))),R=()=>{let[e,s]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(c.C5&&window.electron)s(!0),window.electronReady=!0;else{let e=()=>{s(!0),window.electronReady=!0};return document.addEventListener("electron-ready",e),document.addEventListener("app-init",e),()=>{document.removeEventListener("electron-ready",e),document.removeEventListener("app-init",e)}}},[]),{isElectronReady:e}};function M(){let[e,s]=(0,l.useState)(null),[t,a]=(0,l.useState)(!0),[n,o]=(0,l.useState)(null),[i,d]=(0,l.useState)(0),[m,h]=(0,l.useState)([]),{addNotification:u}=(0,f.l)(),{isElectronReady:p}=R(),{status:g,reconnectAttempts:b,checkConnection:v}=(0,y.h)(),{projects:w,metrics:S,isLoading:C,error:k,refreshData:E,openFile:I}=N(e);(0,l.useEffect)(()=>{let e=!0,r=setTimeout(()=>{e&&t&&a(!1)},1e4),l=async()=>{try{if(!e)return;if(d(e=>e+1),h([8e3,8080,8888,8081,8001,3001,5e3]),c.C5&&!p&&window.electron&&console.log("Electron API準備中、初期化を待機します..."),c.C5)try{let e=localStorage.getItem("lastSelectedPath");e&&(console.log("前回のファイルパスをロード:",e),s(e))}catch(e){console.warn("LocalStorageからの読み込みエラー:",e)}let t=v();await new Promise(e=>setTimeout(e,100));try{let e=await x();if(e.success&&e.path){if(s(e.path),c.C5)try{localStorage.setItem("lastSelectedPath",e.path)}catch(e){console.warn("LocalStorageへの保存エラー:",e)}u("デフォルトファイルを読み込みました","success")}else console.log("デフォルトファイルパスが取得できませんでした")}catch(e){console.warn("デフォルトファイルパス取得エラー:",e)}let r=await t;r||(o({message:"バックエンドサーバーに接続できません。",details:{reason:"別のアプリケーションがAPIポートを使用している可能性があります。",solution:"アプリケーションを再起動するか、使用中のアプリケーションを終了してから再試行してください。"}}),u("バックエンドサーバーに接続できません。","error"))}catch(s){console.error("アプリケーション初期化エラー:",s),e&&(o({message:"アプリケーションの初期化中にエラーが発生しました。APIサーバーに接続できません。",details:s}),u("APIサーバーに接続できません。","error"))}finally{e&&(a(!1),clearTimeout(r))}};return l(),()=>{e=!1,clearTimeout(r)}},[u,v,p]);let M=async()=>{d(e=>e+1),a(!0),o(null);try{let e=Math.min(500*i,2e3);u(`バックエンドサーバーへの接続を再試行しています...(${e}ms 待機)`,"info"),await new Promise(s=>setTimeout(s,e));let t=await j();if(t.success){u("APIサーバーに接続しました","success");let e=await x();e.success&&e.path&&(s(e.path),u("デフォルトファイルを読み込みました","success"))}else o({message:"バックエンドサーバーに接続できません。",details:t.details}),i>=3?u("複数回の接続試行に失敗しました。アプリケーションを再起動してください。","error"):u("APIサーバーに接続できません。","error")}catch(e){console.error("接続再試行エラー:",e),o({message:"APIサーバーに接続できません。",details:e}),u("APIサーバーへの接続試行中にエラーが発生しました。","error")}finally{a(!1)}},q=async()=>{try{u("バックエンドサーバーへの再接続を試みています...","info"),await v()}catch(e){console.error("API再接続エラー:",e),u("バックエンドサーバーへの再接続に失敗しました","error")}};return(0,r.jsxs)("main",{className:"min-h-screen bg-background",children:[r.jsx(P,{updateTime:S?.last_updated||"更新情報がありません",onRefresh:E,selectedFilePath:e,onSelectFile:e=>{if(s(e),c.C5)try{localStorage.setItem("lastSelectedPath",e)}catch(e){console.warn("LocalStorageへの保存エラー:",e)}}}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[r.jsx(D,{onRetry:q}),!t&&n&&n.message.includes("接続できません")?r.jsx(A,{onRetry:M,ports:m,attempts:i,lastError:n.details?.message}):!t&&n?r.jsx($,{message:n.message,details:n.details,onRetry:M}):null,k&&r.jsx($,{message:k.message,details:k.details,onRetry:E}),S&&r.jsx(_,{summary:S.summary,isLoading:C}),r.jsx(F,{projects:w||[],isLoading:C,onOpenFile:I,filePath:e||void 0}),S&&r.jsx(l.Suspense,{fallback:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsx("div",{className:"dashboard-card h-80 flex items-center justify-center",children:r.jsx("div",{className:"animate-pulse text-text-secondary",children:"グラフをロード中..."})}),r.jsx("div",{className:"dashboard-card h-80 flex items-center justify-center",children:r.jsx("div",{className:"animate-pulse text-text-secondary",children:"グラフをロード中..."})})]}),children:r.jsx(L,{metrics:S,isLoading:C})}),!1]})]})}},1018:(e,s,t)=>{"use strict";e.exports=t(7804)},3982:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>n,__esModule:()=>a,default:()=>o});var r=t(5153);let l=(0,r.createProxy)(String.raw`C:\Users\gbrai\Documents\Projects\project-dashboard_ctg\frontend\app\page.tsx`),{__esModule:a,$$typeof:n}=l,c=l.default,o=c}};var s=require("../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[271,520,150],()=>t(7006));module.exports=r})();